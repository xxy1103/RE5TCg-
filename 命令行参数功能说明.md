# 命令行参数功能说明

## 概述

本DNS中继服务器提供了完整的命令行参数支持，完全符合《计算机网络课程设计》任务书要求，支持调试模式、自定义DNS服务器和配置文件等功能。

## 命令行语法

```
dnsrelay [-d | -dd] [dns-server-ipaddr] [filename]
```

### 参数说明

| 参数 | 类型 | 描述 | 默认值 |
|------|------|------|--------|
| `-d` | 选项 | 调试级别1 - 显示基本调试信息 | 关闭 |
| `-dd` | 选项 | 调试级别2 - 显示详细调试信息 | 关闭 |
| `dns-server-ipaddr` | IP地址 | 上游DNS服务器IP地址 | 202.106.0.20 |
| `filename` | 文件路径 | DNS配置文件路径 | dnsrelay.txt |

## 功能特性

### 调试模式

#### 调试级别1 (`-d`)
- 显示基本的运行状态信息
- 记录DNS查询和响应
- 显示缓存命中/未命中情况
- 输出关键错误信息

```bash
# 启用基本调试模式
.\build\bin\my_DNS.exe -d
```

#### 调试级别2 (`-dd`)
- 包含调试级别1的所有信息
- 显示详细的数据包内容
- 记录线程创建和销毁
- 显示内存分配和释放信息
- 输出完整的网络通信日志

```bash
# 启用详细调试模式
.\build\bin\my_DNS.exe -dd
```

### DNS服务器配置

#### 默认服务器
- 系统默认使用 `202.106.0.20` 作为上游DNS服务器
- 这是中国网通的公共DNS服务器，稳定可靠

#### 自定义服务器
```bash
# 使用8.8.8.8作为上游DNS服务器
.\build\bin\my_DNS.exe 8.8.8.8

# 使用自定义DNS服务器并开启调试
.\build\bin\my_DNS.exe -d 114.114.114.114
```

### 配置文件支持

#### 默认配置文件
- 系统默认使用 `dnsrelay.txt` 作为配置文件
- 配置文件包含域名-IP映射规则

#### 自定义配置文件
```bash
# 使用自定义配置文件
.\build\bin\my_DNS.exe custom_dns.txt

# 完整参数组合
.\build\bin\my_DNS.exe -dd 8.8.8.8 my_config.txt
```

## 帮助系统

### 帮助命令
```bash
# 显示完整帮助信息
.\build\bin\my_DNS.exe --help
.\build\bin\my_DNS.exe -h
```

### 帮助信息内容
- 完整的使用语法说明
- 各参数的详细描述
- 使用示例和最佳实践
- 默认值和配置说明

## 参数验证

### 输入验证
- **IP地址格式验证**: 检查DNS服务器IP地址的合法性
- **文件路径验证**: 验证配置文件是否存在和可读
- **参数组合验证**: 确保参数组合的合理性
- **错误提示**: 提供清晰的错误信息和建议

### 错误处理
```bash
# 无效IP地址示例
.\build\bin\my_DNS.exe 999.999.999.999
# 输出: Error: Invalid DNS server IP address

# 不存在的配置文件
.\build\bin\my_DNS.exe nonexistent.txt
# 输出: Error: Configuration file not found
```

## 使用示例

### 基本使用
```bash
# 使用默认配置启动
.\build\bin\my_DNS.exe

# 基本调试模式
.\build\bin\my_DNS.exe -d

# 详细调试模式
.\build\bin\my_DNS.exe -dd
```

### 自定义配置
```bash
# 指定DNS服务器
.\build\bin\my_DNS.exe 8.8.8.8

# 指定配置文件
.\build\bin\my_DNS.exe custom.txt

# 指定DNS服务器和配置文件
.\build\bin\my_DNS.exe 114.114.114.114 my_dns.txt
```

### 高级用法
```bash
# 完整调试模式 + 自定义DNS + 自定义配置
.\build\bin\my_DNS.exe -dd 1.1.1.1 debug_config.txt

# 生产环境推荐配置
.\build\bin\my_DNS.exe 202.106.0.20 production.txt
```

## 技术实现

### 参数解析
- **标准argv/argc处理**: 使用标准C参数解析机制
- **顺序无关性**: 支持参数的灵活排列
- **智能识别**: 自动识别IP地址和文件名
- **默认值填充**: 未指定参数时使用合理默认值

### 配置管理
- **全局配置结构**: 统一管理所有运行时配置
- **配置验证**: 启动前验证所有配置项
- **动态调整**: 支持运行时的部分配置修改
- **错误恢复**: 配置错误时的优雅降级

### 调试输出
- **分级日志**: 根据调试级别控制输出详细程度
- **格式化输出**: 统一的日志格式，便于分析
- **性能考虑**: 调试模式对性能影响最小化
- **文件输出**: 支持将调试信息输出到文件

## 符合性验证

### 任务书要求
✅ **命令行语法**: 完全符合 `dnsrelay [-d | -dd] [dns-server-ipaddr] [filename]` 格式  
✅ **调试级别**: 正确实现 `-d` 和 `-dd` 两个调试级别  
✅ **默认DNS服务器**: 使用指定的 `202.106.0.20`  
✅ **默认配置文件**: 使用指定的 `dnsrelay.txt`  
✅ **参数可选性**: 所有参数都是可选的，有合理默认值  

### 功能完整性
✅ **帮助系统**: 提供 `--help` 和 `-h` 选项  
✅ **错误处理**: 完善的参数验证和错误提示  
✅ **使用灵活性**: 支持参数的多种组合方式  
✅ **稳定性**: 异常输入不会导致程序崩溃  

## 使用建议

### 开发调试
- 使用 `-dd` 模式进行详细调试
- 结合自定义配置文件测试不同场景
- 利用日志输出分析程序行为

### 生产部署
- 关闭调试模式以获得最佳性能
- 使用稳定的DNS服务器（如默认的202.106.0.20）
- 定期备份和验证配置文件

### 故障排除
- 使用调试模式快速定位问题
- 检查DNS服务器的可达性
- 验证配置文件的格式和内容

## 技术总结

命令行参数功能的实现严格遵循课程设计任务书要求，提供了完整、灵活、易用的参数配置机制。通过合理的默认值设置和全面的错误处理，确保了程序的稳定性和用户体验。实现符合工业级软件的标准，具备良好的可维护性和扩展性。 