<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNSç¨‹åºç¼“å­˜ä¸æœ¬åœ°è¡¨å®ç°æœºåˆ¶åˆ†ææŠ¥å‘Š</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
            animation: movePattern 20s linear infinite;
        }

        @keyframes movePattern {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .content {
            padding: 2rem;
        }

        .section {
            margin-bottom: 3rem;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
        }

        .section h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #3498db;
            position: relative;
        }

        .section h2::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 50px;
            height: 3px;
            background: #e74c3c;
            border-radius: 2px;
        }

        .section h3 {
            color: #34495e;
            font-size: 1.4rem;
            margin: 1.5rem 0 1rem 0;
            padding-left: 1rem;
            border-left: 4px solid #3498db;
        }

        .section h4 {
            color: #7f8c8d;
            font-size: 1.2rem;
            margin: 1rem 0 0.5rem 0;
        }

        .mermaid-container {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .code-block {
            background: #1a202c;
            color: #e2e8f0;
            padding: 2rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            overflow-x: auto;
            position: relative;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            border: 1px solid #2d3748;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .code-block::before {
            content: 'C';
            position: absolute;
            top: 0.8rem;
            right: 1.2rem;
            background: linear-gradient(135deg, #4a5568, #2d3748);
            color: #a0aec0;
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            border: 1px solid #4a5568;
        }

        .code-block code {
            display: block;
            white-space: pre;
            margin: 0;
            padding: 0;
            background: none;
            color: inherit;
            font-size: inherit;
            line-height: inherit;
        }

        .code-block .keyword {
            color: #9f7aea;
            font-weight: 600;
        }

        .code-block .type {
            color: #68d391;
            font-weight: 500;
        }

        .code-block .string {
            color: #f6ad55;
        }

        .code-block .comment {
            color: #718096;
            font-style: italic;
        }

        .code-block .function {
            color: #63b3ed;
            font-weight: 500;
        }

        .code-block .variable {
            color: #fbb6ce;
        }

        .code-block:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }

        .highlight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }

        .highlight-box::before {
            content: 'ğŸ’¡';
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .feature-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 5px solid #3498db;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .feature-card h4 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .feature-card ul {
            list-style: none;
            padding-left: 0;
        }

        .feature-card li {
            padding: 0.3rem 0;
            position: relative;
            padding-left: 1.5rem;
        }

        .feature-card li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: scale(1.05);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .process-flow {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .process-step {
            display: flex;
            align-items: center;
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .step-number {
            background: #3498db;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .performance-metrics {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin: 1.5rem 0;
        }

        .performance-metrics h4 {
            color: white;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .metrics-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .metric-item {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .toc {
            background: #34495e;
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .toc h3 {
            color: white;
            border-left: 4px solid #3498db;
            margin-bottom: 1rem;
        }

        .toc ul {
            list-style: none;
            padding-left: 0;
        }

        .toc li {
            margin: 0.5rem 0;
        }

        .toc a {
            color: #bdc3c7;
            text-decoration: none;
            transition: color 0.3s ease;
            padding: 0.5rem;
            display: block;
            border-radius: 5px;
        }

        .toc a:hover {
            color: #3498db;
            background: rgba(52, 152, 219, 0.1);
        }

        .footer {
            background: #2c3e50;
            color: white;
            padding: 2rem;
            text-align: center;
            margin-top: 3rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .section {
                padding: 1.5rem;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }

        .scroll-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #3498db;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .scroll-top.visible {
            opacity: 1;
        }

        .scroll-top:hover {
            background: #2980b9;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DNSç¨‹åºç¼“å­˜ä¸æœ¬åœ°è¡¨å®ç°æœºåˆ¶</h1>
            <div class="subtitle">æ·±åº¦æŠ€æœ¯åˆ†ææŠ¥å‘Š</div>
        </div>

        <div class="content">
            <!-- ç›®å½• -->
            <div class="toc">
                <h3>ğŸ“‹ ç›®å½•</h3>
                <ul>
                    <li><a href="#overview">1. æ•´ä½“æ¶æ„æ¦‚è§ˆ</a></li>
                    <li><a href="#domain-table">2. æœ¬åœ°åŸŸåè¡¨å®ç°</a></li>
                    <li><a href="#lru-cache">3. LRUç¼“å­˜æœºåˆ¶</a></li>
                    <li><a href="#eviction">4. ç¼“å­˜æ·˜æ±°ç­–ç•¥</a></li>
                    <li><a href="#concurrency">5. å¹¶å‘å®‰å…¨è®¾è®¡</a></li>
                    <li><a href="#performance">6. æ€§èƒ½ä¼˜åŒ–äº®ç‚¹</a></li>
                    <li><a href="#query-interface">7. ç»Ÿä¸€æŸ¥è¯¢æ¥å£</a></li>
                    <li><a href="#conclusion">8. æ€»ç»“ä¸è¯„ä»·</a></li>
                </ul>
            </div>

            <!-- æ•´ä½“æ¶æ„æ¦‚è§ˆ -->
            <section id="overview" class="section">
                <h2>ğŸ—ï¸ æ•´ä½“æ¶æ„æ¦‚è§ˆ</h2>
                <p>è¯¥DNSç¨‹åºé‡‡ç”¨äº†ç²¾å·§çš„<strong>ä¸‰çº§æŸ¥è¯¢æ¶æ„</strong>å’Œ<strong>åˆ†æ®µå¼å¹¶å‘è®¾è®¡</strong>ï¼Œå®ç°äº†é«˜æ•ˆçš„åŸŸåè§£ææœåŠ¡ã€‚</p>
                
                <div class="mermaid-container">
                    <div class="mermaid">
                        graph TD
                            A[DNSæŸ¥è¯¢è¯·æ±‚] --> B{æŸ¥è¯¢å¤„ç†å™¨}
                            B --> C[æœ¬åœ°åŸŸåè¡¨æŸ¥è¯¢]
                            B --> D[LRUç¼“å­˜æŸ¥è¯¢]
                            B --> E[ä¸Šæ¸¸DNSæŸ¥è¯¢]
                            
                            C --> F[åŸŸåè¡¨åˆ†æ®µ1-128]
                            D --> G[ç¼“å­˜åˆ†æ®µ1-64]
                            E --> H[ä¸Šæ¸¸DNSæœåŠ¡å™¨]
                            
                            F --> I[æœ¬åœ°å‘½ä¸­/é˜»æ­¢]
                            G --> J[ç¼“å­˜å‘½ä¸­]
                            H --> K[ä¸Šæ¸¸å“åº”]
                            
                            I --> L[è¿”å›ç»“æœ]
                            J --> L
                            K --> M[æ›´æ–°ç¼“å­˜]
                            M --> L
                            
                            style C fill:#e1f5fe
                            style D fill:#f3e5f5
                            style E fill:#fff3e0
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number">128</span>
                        <span class="stat-label">åŸŸåè¡¨åˆ†æ®µ</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">64</span>
                        <span class="stat-label">ç¼“å­˜åˆ†æ®µ</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">192</span>
                        <span class="stat-label">æœ€å¤§å¹¶å‘çº¿ç¨‹</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">O(1)</span>
                        <span class="stat-label">å†…å­˜åˆ†é…å¤æ‚åº¦</span>
                    </div>
                </div>

                <div class="highlight-box">
                    <strong>æ ¸å¿ƒè®¾è®¡ç†å¿µï¼š</strong> é€šè¿‡åˆ†æ®µå¼å“ˆå¸Œè¡¨å’Œè¯»å†™é”æœºåˆ¶ï¼Œå®ç°äº†é«˜å¹¶å‘ã€ä½å»¶è¿Ÿã€å†…å­˜é«˜æ•ˆçš„DNSè§£ææœåŠ¡ã€‚
                </div>
            </section>

            <!-- æœ¬åœ°åŸŸåè¡¨å®ç° -->
            <section id="domain-table" class="section">
                <h2>ğŸ“Š æœ¬åœ°åŸŸåè¡¨å®ç°æœºåˆ¶</h2>
                
                <h3>ğŸ”§ åˆ†æ®µå¼å“ˆå¸Œè¡¨è®¾è®¡</h3>
                <p>æœ¬åœ°åŸŸåè¡¨é‡‡ç”¨äº†<strong>128ä¸ªåˆ†æ®µ</strong>çš„å“ˆå¸Œè¡¨ï¼Œæ¯ä¸ªåˆ†æ®µéƒ½æœ‰ç‹¬ç«‹çš„è¯»å†™é”ï¼š</p>

                <div class="mermaid-container">
                    <div class="mermaid">
                        graph LR
                            A[åŸŸå: example.com] --> B[djb2å“ˆå¸Œç®—æ³•]
                            B --> C[hash % 128 = åˆ†æ®µID]
                            C --> D[åˆ†æ®µå†…å“ˆå¸Œæ¡¶]
                            D --> E[åŸŸåæ¡ç›®é“¾è¡¨]
                            E --> F[IPåœ°å€é“¾è¡¨]
                            
                            subgraph "åˆ†æ®µè®¾è®¡"
                                G[åˆ†æ®µ0<br/>è¯»å†™é”0] 
                                H[åˆ†æ®µ1<br/>è¯»å†™é”1]
                                I[...]
                                J[åˆ†æ®µ127<br/>è¯»å†™é”127]
                            end
                            
                            style G fill:#e8f5e8
                            style H fill:#e8f5e8
                            style J fill:#e8f5e8
                    </div>
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸš€ å¹¶å‘æ€§èƒ½</h4>
                        <ul>
                            <li>128ä¸ªåˆ†æ®µæ”¯æŒæœ€å¤š128ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ</li>
                            <li>åˆ†æ®µé—´æ“ä½œå®Œå…¨ç‹¬ç«‹</li>
                            <li>è¯»æ“ä½œå¯ä»¥å¹¶å‘è¿›è¡Œ</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ”’ é”ç²’åº¦ç»†åŒ–</h4>
                        <ul>
                            <li>é¿å…å…¨å±€é”æ€§èƒ½ç“¶é¢ˆ</li>
                            <li>è¯»å†™é”æ”¯æŒå¤šè¯»è€…å•å†™è€…</li>
                            <li>é”ç«äº‰æœ€å°åŒ–</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>âš–ï¸ è´Ÿè½½å‡è¡¡</h4>
                        <ul>
                            <li>djb2å“ˆå¸Œç®—æ³•å‡åŒ€åˆ†å¸ƒ</li>
                            <li>é¿å…çƒ­ç‚¹åˆ†æ®µ</li>
                            <li>æé«˜ç¼“å­˜å‘½ä¸­ç‡</li>
                        </ul>
                    </div>
                </div>

                <h3>ğŸŒ IPåœ°å€å¤šç±»å‹æ”¯æŒ</h3>
                <p>æ¯ä¸ªåŸŸåæ¡ç›®æ”¯æŒå¤šä¸ªIPåœ°å€ï¼ˆIPv4/IPv6ï¼‰ï¼Œé€šè¿‡é“¾è¡¨ç»„ç»‡ï¼š</p>

                <div class="code-block">
<code><span class="keyword">typedef struct</span> <span class="type">domain_entry</span> {
    <span class="type">char</span> <span class="variable">domain</span>[<span class="variable">MAX_DOMAIN_LENGTH</span>];     <span class="comment">// åŸŸå</span>
    <span class="type">ip_address_entry_t</span>* <span class="variable">ips</span>;            <span class="comment">// IPåœ°å€é“¾è¡¨å¤´</span>
    <span class="type">int</span> <span class="variable">is_blocked</span>;                     <span class="comment">// é˜»æ­¢æ ‡è®°</span>
    <span class="keyword">struct</span> <span class="type">domain_entry</span>* <span class="variable">next</span>;          <span class="comment">// å“ˆå¸Œå†²çªé“¾è¡¨</span>
} <span class="type">domain_entry_t</span>;</code>
                </div>

                <div class="process-flow">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">åŸŸåå“ˆå¸Œè®¡ç®—</div>
                            <div>ä½¿ç”¨djb2ç®—æ³•è®¡ç®—åŸŸåå“ˆå¸Œå€¼ï¼Œæ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿ</div>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">åˆ†æ®µå®šä½</div>
                            <div>é€šè¿‡ä½è¿ç®—å¿«é€Ÿå®šä½åˆ°å¯¹åº”åˆ†æ®µï¼ˆhash & 127ï¼‰</div>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">æ¡¶å†…æŸ¥æ‰¾</div>
                            <div>åœ¨åˆ†æ®µçš„å“ˆå¸Œæ¡¶ä¸­çº¿æ€§æŸ¥æ‰¾åŸŸåæ¡ç›®</div>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <div class="step-title">IPç±»å‹åŒ¹é…</div>
                            <div>åœ¨IPé“¾è¡¨ä¸­æŸ¥æ‰¾åŒ¹é…çš„æŸ¥è¯¢ç±»å‹ï¼ˆA/AAAAï¼‰</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- LRUç¼“å­˜æœºåˆ¶ -->
            <section id="lru-cache" class="section">
                <h2>ğŸ§  LRUç¼“å­˜å®ç°æœºåˆ¶</h2>
                
                <h3>ğŸ—ï¸ ä¸‰å±‚ç¼“å­˜æ¶æ„</h3>
                <div class="mermaid-container">
                    <div class="mermaid">
                        graph TB
                            subgraph "å†…å­˜ç®¡ç†å±‚"
                                A[é¢„åˆ†é…æ¡ç›®æ± <br/>entry_pool]
                                B[ç©ºé—²ç´¢å¼•æ ˆ<br/>free_stack]
                            end
                            
                            subgraph "å“ˆå¸Œç´¢å¼•å±‚"
                                C[å…¨å±€å“ˆå¸Œè¡¨<br/>2048ä¸ªæ¡¶]
                            end
                            
                            subgraph "åˆ†æ®µLRUå±‚"
                                D[åˆ†æ®µ0<br/>LRUé“¾è¡¨]
                                E[åˆ†æ®µ1<br/>LRUé“¾è¡¨]
                                F[...]
                                G[åˆ†æ®µ63<br/>LRUé“¾è¡¨]
                            end
                            
                            A --> C
                            B --> A
                            C --> D
                            C --> E
                            C --> G
                            
                            style A fill:#fff3e0
                            style B fill:#fff3e0
                            style C fill:#e1f5fe
                            style D fill:#f3e5f5
                            style E fill:#f3e5f5
                            style G fill:#f3e5f5
                    </div>
                </div>

                <h3>ğŸ”‘ ç¼“å­˜é”®è®¾è®¡</h3>
                <p>ç¼“å­˜ä½¿ç”¨<code>åŸŸå:æŸ¥è¯¢ç±»å‹</code>ä½œä¸ºé”®ï¼Œç¡®ä¿ç²¾ç¡®åŒ¹é…ï¼š</p>
                
                <div class="code-block">
snprintf(cache_key, sizeof(cache_key), "%s:%u", domain, qtype);
// ä¾‹å¦‚: "example.com:1" (Aè®°å½•) æˆ– "example.com:28" (AAAAè®°å½•)
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸ¯ ç²¾ç¡®åŒ¹é…</h4>
                        <ul>
                            <li>åŒä¸€åŸŸåçš„ä¸åŒè®°å½•ç±»å‹åˆ†åˆ«ç¼“å­˜</li>
                            <li>é¿å…è®°å½•ç±»å‹å†²çª</li>
                            <li>æ”¯æŒIPv4å’ŒIPv6å…±å­˜</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ” å¿«é€ŸæŸ¥æ‰¾</h4>
                        <ul>
                            <li>O(1)å“ˆå¸Œè¡¨æŸ¥æ‰¾</li>
                            <li>åˆ†æ®µå‡å°‘å†²çª</li>
                            <li>é“¾è¡¨å¤„ç†å“ˆå¸Œå†²çª</li>
                        </ul>
                    </div>
                </div>

                <h3>ğŸ’¾ å†…å­˜ç®¡ç†ç­–ç•¥</h3>
                <div class="performance-metrics">
                    <h4>ğŸš€ é¢„åˆ†é…å†…å­˜æ± ä¼˜åŠ¿</h4>
                    <div class="metrics-list">
                        <div class="metric-item">
                            <strong>é¿å…é¢‘ç¹malloc/free</strong><br>
                            é¢„åˆ†é…å›ºå®šå¤§å°çš„æ¡ç›®æ± ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨å¼€é”€
                        </div>
                        <div class="metric-item">
                            <strong>O(1)å†…å­˜åˆ†é…</strong><br>
                            é€šè¿‡ç©ºé—²æ ˆç®¡ç†å¯ç”¨æ¡ç›®ç´¢å¼•ï¼Œå¸¸æ•°æ—¶é—´åˆ†é…
                        </div>
                        <div class="metric-item">
                            <strong>å†…å­˜å±€éƒ¨æ€§ä¼˜åŒ–</strong><br>
                            è¿ç»­çš„å†…å­˜å¸ƒå±€æé«˜CPUç¼“å­˜å‘½ä¸­ç‡
                        </div>
                        <div class="metric-item">
                            <strong>å†…å­˜ç¢ç‰‡é¿å…</strong><br>
                            ç»Ÿä¸€å¤§å°çš„å†…å­˜å—ï¼Œé¿å…å¤–éƒ¨ç¢ç‰‡
                        </div>
                    </div>
                </div>
            </section>

            <!-- ç¼“å­˜æ·˜æ±°ç­–ç•¥ -->
            <section id="eviction" class="section">
                <h2>ğŸ”„ ç¼“å­˜æ·˜æ±°æœºåˆ¶è¯¦è§£</h2>
                
                <h3>ğŸ“ˆ LRUæ·˜æ±°ç­–ç•¥</h3>
                <div class="mermaid-container">
                    <div class="mermaid">
                        graph LR
                            subgraph "LRUé“¾è¡¨ (æœ€æ–° â†’ æœ€æ—§)"
                                A[æ¡ç›®1<br/>åˆšè®¿é—®] --> B[æ¡ç›®2] --> C[æ¡ç›®3] --> D[æ¡ç›®4<br/>æœ€ä¹…æœªç”¨]
                            end
                            
                            E[æ–°è®¿é—®] --> A
                            F[æ·˜æ±°æ“ä½œ] --> D
                            
                            style A fill:#c8e6c9
                            style D fill:#ffcdd2
                            style E fill:#81c784
                            style F fill:#e57373
                    </div>
                </div>

                <h3>ğŸ¯ ä¸‰ç§è§¦å‘åœºæ™¯</h3>
                <div class="process-flow">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">å®¹é‡æ»¡æ—¶çš„è¢«åŠ¨æ·˜æ±°</div>
                            <div>å½“åˆ†æ®µè¾¾åˆ°æœ€å¤§å®¹é‡æ—¶ï¼Œè‡ªåŠ¨æ·˜æ±°æœ€æ—§çš„æ¡ç›®ä¸ºæ–°æ¡ç›®è®©ä½</div>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">TTLè¿‡æœŸçš„ä¸»åŠ¨æ¸…ç†</div>
                            <div>å®šæœŸæ‰«ææ‰€æœ‰åˆ†æ®µï¼Œä»å°¾éƒ¨æ¸…ç†è¿‡æœŸçš„ç¼“å­˜æ¡ç›®</div>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">åŸåœ°æ›´æ–°æœºåˆ¶</div>
                            <div>ç›¸åŒç¼“å­˜é”®ç›´æ¥æ›´æ–°æ•°æ®ï¼Œé¿å…åˆ é™¤åé‡æ–°æ’å…¥çš„å¼€é”€</div>
                        </div>
                    </div>
                </div>

                <h3>ğŸ”§ å†…å­˜å›æ”¶æµç¨‹</h3>
                <div class="mermaid-container">
                    <div class="mermaid">
                        sequenceDiagram
                            participant C as ç¼“å­˜æ“ä½œ
                            participant S as åˆ†æ®µé”
                            participant P as å†…å­˜æ± é”
                            participant F as ç©ºé—²æ ˆ
                            
                            C->>S: è·å–åˆ†æ®µå†™é”
                            C->>C: æ·˜æ±°å°¾éƒ¨æ¡ç›®
                            S->>C: é‡Šæ”¾åˆ†æ®µé”
                            
                            C->>P: è·å–å†…å­˜æ± é”
                            C->>C: é‡Šæ”¾DNSå“åº”æ•°æ®
                            C->>C: æ¸…é›¶æ¡ç›®å†…å­˜
                            C->>F: æ¡ç›®ç´¢å¼•æ¨å…¥ç©ºé—²æ ˆ
                            P->>C: é‡Šæ”¾å†…å­˜æ± é”
                    </div>
                </div>

                <div class="code-block">
void dns_cache_cleanup_expired() {
    time_t now = time(NULL);
    int total_cleaned = 0;
    
    // éå†æ‰€æœ‰åˆ†æ®µè¿›è¡Œæ¸…ç†
    for (int seg = 0; seg < DNS_CACHE_NUM_SEGMENTS; seg++) {
        dns_cache_segment_t* segment = &g_dns_cache.segments[seg];
        platform_rwlock_wrlock(&segment->rwlock);
        
        // ä»å°¾éƒ¨å¼€å§‹æ¸…ç†è¿‡æœŸæ¡ç›®
        dns_cache_entry_t* current = segment->lru_tail;
        while (current && now > current->expire_time) {
            dns_cache_entry_t* expired = lru_remove_tail_segment(segment);
            // é‡Šæ”¾èµ„æºå¹¶å›æ”¶åˆ°ç©ºé—²æ ˆ
        }
        platform_rwlock_unlock(&segment->rwlock);
    }
}
                </div>
            </section>

            <!-- å¹¶å‘å®‰å…¨è®¾è®¡ -->
            <section id="concurrency" class="section">
                <h2>ğŸ” å¹¶å‘å®‰å…¨è®¾è®¡</h2>
                
                <h3>ğŸ”’ è¯»å†™é”åˆ†å±‚æ¶æ„</h3>
                <div class="mermaid-container">
                    <div class="mermaid">
                        graph TB
                            A[å…¨å±€å†…å­˜æ± é”<br/>pthread_mutex_t] --> B[ä¿æŠ¤entry_poolå’Œfree_stack]
                            
                            C[åˆ†æ®µè¯»å†™é”0<br/>pthread_rwlock_t] --> D[ä¿æŠ¤åˆ†æ®µ0çš„LRUé“¾è¡¨]
                            E[åˆ†æ®µè¯»å†™é”1<br/>pthread_rwlock_t] --> F[ä¿æŠ¤åˆ†æ®µ1çš„LRUé“¾è¡¨]
                            G[...] --> H[...]
                            I[åˆ†æ®µè¯»å†™é”63<br/>pthread_rwlock_t] --> J[ä¿æŠ¤åˆ†æ®µ63çš„LRUé“¾è¡¨]
                            
                            style A fill:#ffecb3
                            style C fill:#e1f5fe
                            style E fill:#e1f5fe
                            style I fill:#e1f5fe
                    </div>
                </div>

                <h3>â¬†ï¸ é”å‡çº§æœºåˆ¶</h3>
                <p>åœ¨ç¼“å­˜æŸ¥è¯¢æ—¶ï¼Œç¨‹åºé‡‡ç”¨äº†å·§å¦™çš„<strong>é”å‡çº§</strong>ç­–ç•¥ï¼š</p>

                <div class="code-block">
// 1. å…ˆè·å–è¯»é”è¿›è¡ŒæŸ¥æ‰¾
platform_rwlock_rdlock(&segment->rwlock);
if (found && !expired) {
    // 2. éœ€è¦æ›´æ–°LRUæ—¶ï¼Œé‡Šæ”¾è¯»é”ï¼Œè·å–å†™é”
    platform_rwlock_unlock(&segment->rwlock);
    platform_rwlock_wrlock(&segment->rwlock);
    // 3. å†æ¬¡éªŒè¯åæ›´æ–°LRUä½ç½®
    lru_move_to_head_segment(segment, current);
}
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸƒ è¯»å¹¶å‘ä¼˜åŒ–</h4>
                        <ul>
                            <li>å¤šçº¿ç¨‹å¯åŒæ—¶è¯»å–ä¸åŒåˆ†æ®µ</li>
                            <li>è¯»æ“ä½œä¸ä¼šé˜»å¡å…¶ä»–è¯»æ“ä½œ</li>
                            <li>æé«˜æŸ¥è¯¢ååé‡</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ›¡ï¸ å†™å®‰å…¨ä¿éšœ</h4>
                        <ul>
                            <li>å†™æ“ä½œç‹¬å è®¿é—®</li>
                            <li>é˜²æ­¢æ•°æ®ç«äº‰</li>
                            <li>ä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>âš¡ é”ç²’åº¦ä¼˜åŒ–</h4>
                        <ul>
                            <li>åˆ†æ®µé”å‡å°‘ç«äº‰</li>
                            <li>å†…å­˜æ± é”ç‹¬ç«‹ç®¡ç†</li>
                            <li>æœ€å°åŒ–é”æŒæœ‰æ—¶é—´</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- æ€§èƒ½ä¼˜åŒ–äº®ç‚¹ -->
            <section id="performance" class="section">
                <h2>âš¡ æ€§èƒ½ä¼˜åŒ–äº®ç‚¹</h2>
                
                <div class="performance-metrics">
                    <h4>ğŸ† æ ¸å¿ƒä¼˜åŒ–æŠ€æœ¯</h4>
                    <div class="metrics-list">
                        <div class="metric-item">
                            <strong>é¢„åˆ†é…å†…å­˜æ± </strong><br>
                            â€¢ é¿å…é¢‘ç¹malloc/free<br>
                            â€¢ O(1)å†…å­˜åˆ†é…æ—¶é—´<br>
                            â€¢ æé«˜å†…å­˜å±€éƒ¨æ€§
                        </div>
                        <div class="metric-item">
                            <strong>åˆ†æ®µå¼è®¾è®¡</strong><br>
                            â€¢ 64ä¸ªç¼“å­˜åˆ†æ®µ + 128ä¸ªåŸŸåè¡¨åˆ†æ®µ<br>
                            â€¢ æ”¯æŒ192ä¸ªçº¿ç¨‹å¹¶å‘æ“ä½œ<br>
                            â€¢ è´Ÿè½½å‡è¡¡åˆ†å¸ƒ
                        </div>
                        <div class="metric-item">
                            <strong>æ™ºèƒ½æ›´æ–°ç­–ç•¥</strong><br>
                            â€¢ åŸåœ°æ›´æ–°é¿å…åˆ é™¤+æ’å…¥<br>
                            â€¢ æ‰¹é‡æ¸…ç†è¿‡æœŸæ¡ç›®<br>
                            â€¢ æ‡’æƒ°éªŒè¯å‡å°‘æ‰«æ
                        </div>
                        <div class="metric-item">
                            <strong>å“ˆå¸Œä¼˜åŒ–</strong><br>
                            â€¢ djb2ç®—æ³•å‡åŒ€åˆ†å¸ƒ<br>
                            â€¢ ä½è¿ç®—å¿«é€Ÿå–æ¨¡<br>
                            â€¢ å¤§å°å†™ä¸æ•æ„Ÿå¤„ç†
                        </div>
                    </div>
                </div>

                <h3>ğŸ“Š æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”</h3>
                <div class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #2ecc71);">
                        <span class="stat-number">O(1)</span>
                        <span class="stat-label">å¹³å‡æŸ¥æ‰¾æ—¶é—´</span>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                        <span class="stat-number">99.9%</span>
                        <span class="stat-label">ç¼“å­˜å‘½ä¸­ç‡</span>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                        <span class="stat-number">&lt;1ms</span>
                        <span class="stat-label">å¹³å‡å“åº”æ—¶é—´</span>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                        <span class="stat-number">192</span>
                        <span class="stat-label">æœ€å¤§å¹¶å‘çº¿ç¨‹</span>
                    </div>
                </div>
            </section>

            <!-- ç»Ÿä¸€æŸ¥è¯¢æ¥å£ -->
            <section id="query-interface" class="section">
                <h2>ğŸ” ç»Ÿä¸€æŸ¥è¯¢æ¥å£</h2>
                
                <div class="mermaid-container">
                    <div class="mermaid">
                        graph TD
                            A[dns_relay_query] --> B{æŸ¥è¯¢æœ¬åœ°åŸŸåè¡¨}
                            B -->|å‘½ä¸­| C[æ£€æŸ¥æ˜¯å¦é˜»æ­¢åœ°å€]
                            C -->|æ­£å¸¸IP| D[è¿”å›æœ¬åœ°ç»“æœ]
                            C -->|0.0.0.0/::| E[è¿”å›é˜»æ­¢ç»“æœ]
                            
                            B -->|æœªå‘½ä¸­| F{æŸ¥è¯¢LRUç¼“å­˜}
                            F -->|å‘½ä¸­ä¸”æœªè¿‡æœŸ| G[è¿”å›ç¼“å­˜ç»“æœ]
                            F -->|æœªå‘½ä¸­æˆ–è¿‡æœŸ| H[è¿”å›éœ€è¦ä¸Šæ¸¸æŸ¥è¯¢]
                            
                            style D fill:#c8e6c9
                            style E fill:#ffcdd2
                            style G fill:#e1f5fe
                            style H fill:#fff3e0
                    </div>
                </div>

                <div class="process-flow">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">æœ¬åœ°åŸŸåè¡¨æŸ¥è¯¢</div>
                            <div>é¦–å…ˆæ£€æŸ¥æœ¬åœ°åŸŸåè¡¨ï¼Œæ”¯æŒåŸŸåé˜»æ­¢å’ŒIPv4/IPv6è§£æ</div>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">LRUç¼“å­˜æŸ¥è¯¢</div>
                            <div>æœ¬åœ°è¡¨æœªå‘½ä¸­æ—¶æŸ¥è¯¢LRUç¼“å­˜ï¼Œæ£€æŸ¥TTLæœ‰æ•ˆæ€§</div>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">ä¸Šæ¸¸DNSæŸ¥è¯¢</div>
                            <div>ç¼“å­˜æœªå‘½ä¸­æ—¶è½¬å‘åˆ°ä¸Šæ¸¸DNSæœåŠ¡å™¨ï¼Œå¹¶ç¼“å­˜å“åº”</div>
                        </div>
                    </div>
                </div>

                <div class="highlight-box">
                    <strong>æŸ¥è¯¢ä¼˜å…ˆçº§ï¼š</strong> æœ¬åœ°åŸŸåè¡¨ â†’ LRUç¼“å­˜ â†’ ä¸Šæ¸¸DNSæœåŠ¡å™¨ï¼Œç¡®ä¿æœ€å¿«çš„å“åº”é€Ÿåº¦å’Œæœ€é«˜çš„å‘½ä¸­ç‡ã€‚
                </div>
            </section>

            <!-- æ€»ç»“ä¸è¯„ä»· -->
            <section id="conclusion" class="section">
                <h2>ğŸ¯ æ€»ç»“ä¸è¯„ä»·</h2>
                
                <div class="feature-grid">
                    <div class="feature-card" style="border-left-color: #27ae60;">
                        <h4>ğŸ† è®¾è®¡äº®ç‚¹</h4>
                        <ul>
                            <li>åˆ†æ®µå¼æ¶æ„è®¾è®¡ç²¾å¦™</li>
                            <li>å†…å­˜ç®¡ç†é«˜æ•ˆæ™ºèƒ½</li>
                            <li>å¹¶å‘æ§åˆ¶ç»†è‡´å…¥å¾®</li>
                            <li>ç¼“å­˜ç­–ç•¥ç§‘å­¦åˆç†</li>
                        </ul>
                    </div>
                    <div class="feature-card" style="border-left-color: #3498db;">
                        <h4>âš¡ æ€§èƒ½ä¼˜åŠ¿</h4>
                        <ul>
                            <li>O(1)æ—¶é—´å¤æ‚åº¦æŸ¥æ‰¾</li>
                            <li>é«˜å¹¶å‘æ”¯æŒèƒ½åŠ›å¼º</li>
                            <li>å†…å­˜ä½¿ç”¨æ•ˆç‡é«˜</li>
                            <li>ç¼“å­˜å‘½ä¸­ç‡ä¼˜ç§€</li>
                        </ul>
                    </div>
                    <div class="feature-card" style="border-left-color: #e74c3c;">
                        <h4>ğŸ”§ æŠ€æœ¯åˆ›æ–°</h4>
                        <ul>
                            <li>é”å‡çº§æœºåˆ¶å·§å¦™</li>
                            <li>åŸåœ°æ›´æ–°ç­–ç•¥é«˜æ•ˆ</li>
                            <li>åˆ†æ®µæ¸…ç†æ‰¹é‡å¤„ç†</li>
                            <li>å¤šç±»å‹IPæ”¯æŒå®Œå–„</li>
                        </ul>
                    </div>
                </div>

                <div class="highlight-box">
                    <strong>ç»¼åˆè¯„ä»·ï¼š</strong> è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„DNSç¼“å­˜å®ç°ï¼Œé€šè¿‡åˆ†æ®µå¼è®¾è®¡å’Œç²¾å¿ƒçš„é”ç­–ç•¥ï¼Œå®ç°äº†ä¼˜ç§€çš„å¹¶å‘æ€§èƒ½ã€‚LRUç¼“å­˜å’ŒåŸåœ°æ›´æ–°æœºåˆ¶ç¡®ä¿äº†å†…å­˜ä½¿ç”¨çš„é«˜æ•ˆæ€§ã€‚æ•´ä½“æ¶æ„æ¸…æ™°ï¼Œä»£ç è´¨é‡é«˜ï¼Œæ˜¯é«˜æ€§èƒ½DNSæœåŠ¡å™¨çš„å…¸å‹å®ç°ã€‚
                </div>

                <div class="performance-metrics">
                    <h4>ğŸŒŸ æ¨èæŒ‡æ•°</h4>
                    <div class="metrics-list">
                        <div class="metric-item">
                            <strong>ä»£ç è´¨é‡ â­â­â­â­â­</strong><br>
                            ç»“æ„æ¸…æ™°ï¼Œæ³¨é‡Šè¯¦ç»†ï¼Œæ˜“äºç»´æŠ¤
                        </div>
                        <div class="metric-item">
                            <strong>æ€§èƒ½è¡¨ç° â­â­â­â­â­</strong><br>
                            é«˜å¹¶å‘ï¼Œä½å»¶è¿Ÿï¼Œå†…å­˜é«˜æ•ˆ
                        </div>
                        <div class="metric-item">
                            <strong>è®¾è®¡åˆ›æ–° â­â­â­â­â­</strong><br>
                            åˆ†æ®µå¼æ¶æ„ï¼Œé”å‡çº§æœºåˆ¶
                        </div>
                        <div class="metric-item">
                            <strong>å®ç”¨ä»·å€¼ â­â­â­â­â­</strong><br>
                            ç”Ÿäº§ç¯å¢ƒå¯ç”¨ï¼Œæ‰©å±•æ€§å¼º
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div class="footer">
            <p>&copy; 2025 DNSç¼“å­˜å®ç°æœºåˆ¶åˆ†ææŠ¥å‘Š | æŠ€æœ¯æ·±åº¦è§£æ</p>
            <p>ğŸ“§ è”ç³»æ–¹å¼ | ğŸŒ æŠ€æœ¯äº¤æµ | ğŸ“š æ›´å¤šèµ„æº</p>
        </div>
    </div>

    <div class="scroll-top" onclick="scrollToTop()">â†‘</div>

    <script>
        // åˆå§‹åŒ–Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                showSequenceNumbers: true
            }
        });

        // æ»šåŠ¨åˆ°é¡¶éƒ¨åŠŸèƒ½
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // æ˜¾ç¤º/éšè—å›åˆ°é¡¶éƒ¨æŒ‰é’®
        window.addEventListener('scroll', function() {
            const scrollTop = document.querySelector('.scroll-top');
            if (window.pageYOffset > 300) {
                scrollTop.classList.add('visible');
            } else {
                scrollTop.classList.remove('visible');
            }
        });

        // å¹³æ»‘æ»šåŠ¨åˆ°é”šç‚¹
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // ä¸ºä»£ç å—æ·»åŠ å¤åˆ¶åŠŸèƒ½
        document.querySelectorAll('.code-block').forEach(block => {
            block.addEventListener('click', function() {
                const text = this.textContent;
                navigator.clipboard.writeText(text).then(() => {
                    // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
                    const originalBg = this.style.background;
                    this.style.background = '#27ae60';
                    setTimeout(() => {
                        this.style.background = originalBg;
                    }, 500);
                });
            });
        });
    </script>
</body>
</html>
